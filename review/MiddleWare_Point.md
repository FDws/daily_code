# 中间件

## 中间件
1. 定义: 中间件是一种软件, 他能使处于应用层中的各个应用成分之间实现跨网络的协同工作, 即互操作, 这时允许应用成分之下的系统结构, 操作系统, 通信协议, 数据库和其他应用服务各不相同
2. 异构性: 应用环境复杂, 硬件系统多样, 硬件之上的操作系统和应用软件不同, 网络结构不同
3. 中间件产生的原因: 使得分布式环境中的应用可以实现跨网络的协同工作
4. 分类
    - 事务处理中间件: 用于对分布式计算环境产生的事务进行监控和管理. 事务处理中间件把自己的事务处理功能和数据库以有的事务管理功能有机的结合在一起, 实现对分布式事务的全局管理
    - 消息中间件: 应用程序之间需要传递信息, 消息中间件根据要传递的消息, 在应用之间建立连接, 他既允许各应用运行在不同的节点机上, 又允许不必标准化的消息格式, 并且保证消息能够不重复的传送到适当的目的地
        - 消息队列: 消息发送到一个队列中, 收件人可以在任何时候查看队列, 传输质量有保证, 但不知道收件人是否已经阅读到该消息, 一对一
        - 发布-订阅: 消息广播给多个收信人, 常常使用多址广播, 一对多
    - 分布式中间件: 分布式中间件实现了真正的通用软件总线. 具有优良的互操作和应用程序集成能力. 这些应用程序可以位于网络的任何地方, 彼此透明操作

## RPC 远程过程调用
1. 基本功能: 
    - 从语义角度, RPC使用过程调用实现远程通信
    - 从应用角度, RPC基于过程调用的远程通信特点为网络和分布式系统的应用提供了灵活方便的通信功能
    - RPC的实现机制的实质是实现了七层网络协议中的会话层
2. 模型: 服务方侦听客户端的请求, 当客户的请求到达之后, 调用指定的过程处理, 并把执行的结果返回给客户端
3. 工作机制
    - 用中间件中的IDL对调用顺序加以描述
    - 利用IDL编译器对这种定义和描述进行编译, 生成支持客户机和服务器进行通信的管道
    - 在服务器端, 被调用的远程过程需要单独编写, 并且置入服务器端框架, 同时在远程过程调用中间件进行注册, 以备调用
    - 启动本地客户端存根 -> 存根捆绑远端过程名和参数 -> 利用网络传输到服务端框架, 从而实现数据格式的转换和参数的传递
    - 采用调用/返回模式具体的完成远程过程调用

## RMI 远程方法激发
1. 概念: 在分布式程序中, 使得远程对象的方法能够被运行在不同JVM上的对象调用
2. 目标
    - JVM之间无缝的调用
    - 支持服务器回调
    - 保持面向对象特性
    - 保持JVM的安全性
    - 简单易编写
3. 结构:
    客户端 -> 桩 -> 远程引用层 -> 传输层 -> 远程引用层 -> 框架 -> 服务器
4. 三层结构
    - 桩/框架: 应用层与其他系统部分的接口
        - 桩是客户端内部完成数据打包和网络管理的本地对象. 当客户调用远程对象的方法时, 实际调用的时本地存根对象上的方法
        - 框架是服务器端负责接受数据并解包为本地调用的对象. 远程主机上的每个对象可能对应一个相应的框架
    - 远程引用层是桩和传输层之的中间层, 负责为独立于客户桩和服务器框架的多种形式的远程引用和调用协议提供支持
    - 传输层负责在不同地址空间之间传输序列化的字节流, 远程对象通过一个对象标识符和一个结束点表示, 称为活动引用

## 反射
1. 反射是系统的一种推理和作用于自身的能力. 反射系统是支持因果相连的自表示系统

## 中间件中的事务处理
1. 事务: 事务是指对共享资源的一组不可分割操作, 具有ACID特征
2. X/OPEN DTP模型
    - 应用程序 AP: 事务的使用者, 它发出开始,提交, 回滚事务的请求. 它规定了一个事务的界限, 并给出了事务所包含的操作
    - 资源管理器 RM: 提供对共享资源的访问
    - 事务管理器 TM: AP 与 RM之间的协调员, 他给每个事务分配标识符, 监视他们的进展, 保证事务处理的顺利进行, 并负责事务在失败情况下的恢复
3. 流程: 
    - 应用程序首先通过TX接口告知事务管理器开启一个新事务, 事务管理器负责分配一个全局的标识符, 调用XA接口通知资源管理器新事务开始
    - 然后应用程序访问资源管理器进行操作
    - 当操作完成之后, 应用程序要求事务管理器提交事务
    - 事务管理器调用XA接口协调各资源管理器进行事务的提交
4. 两阶段提交协议 -  保证事务的完整性
    - 准备阶段: 事务管理器询问资源管理器是否已经准备好提交
    - 提交阶段: 当所有的资源管理器都发出肯定的回复, 则事务管理器发出正式的事务提交请求. 当有一个或以上的资源管理器给出否定的回答, 则事务管理器通知各个资源管理器进行回滚

## COM 组件对象模
1. 定义: 一种以组件为发布单元的对象模型, 这种模型使得各组件可以以一种统一的方式进行交互
2. 组件: 具有一定逻辑功能的可执行代码, 是组成应用程序的构件
3. 接口: 对其他软件或组件能使用公共功能的定义, 是组件与外界的交互通道
    - IUnknown: 所有的组件都实现了此接口
    - IDispatch: 继承IUnknown接口, 使得COM组件可以以一个标准的接口提供所支持的服务
    - IDictionary:
    - IClassFactory
4. 结构: COM对象通过COM接口提供服务, COM对象组成COM组件, 进而组成应用程序

## CORBA 公共对象请求代理体系结构
1. 体系结构
    - ORB核心: 软件总线, 跨平台
    - OMG界面定义语言: IDL, 跨语言
    - 语言映射 : C++, Java
    - 界面仓库和实现仓库:  动态调用
    - 静态存根和框架: 静态调用
    - 动态存根和框架: 动态调用
    - 对象适配器: 适配层
    - ORB之间互操作: GIOP/IIOP
2. IOR: 可操作对象引用, 使用对象引用来确定目标对象的位置, 可以在多个不同的ORB之间确定对象的位置

## JavaEE Java企业架构
1. 相关技术:
    - EJB: 定义了服务器端的组件编写规则, 组件之间的交互规则, 应用服务器对组件的管理规则
    - RMI: 远程方法激发, 提供跨进程的相关通信服务
    - RMI-IIOP: 扩展了RMI, 提供与CORBA的集成
    - JNDI: Java名称和目录接口, 用于网络中定位组件和其他资源
    - JDBC: 提供关系数据库的连接与相关的数据库操作
    - JTA/JTS: 使得组件支持事务处理的规范
    - JMS: Java消息服务, 用于分布式对象的异步通信
    - JSP/Servlets: 适用于请求/应答模式分布式计算网络组件
    - JavaIDL: 用于基于Java的CORBA实现, 使Java与其他编程语言集成
    - Connectors: 使JavaEE可以与运行高端事务处理的主机系统集成
    - JCA/JCF/JSSE/JAAS: 安全服务体系, 专门处理身份验证以及权限管控的标准服务
2. 容器
    - EJB容器是EJB组件的运行环境, EJB容器装载EJB, 并且使得客户端程序可以远程调用
    - EJB容器负责将客户端程序连接到Beans, 执行事务协调, 提供数据存储, 管理Beans的生命周期
    - EJB容器透明的管理分布式组件体系结构的系统开销, 无论是Bean还是调用Bean的客户端程序, 都不显式的对EJB容器的API进行编码
    - 从本质上讲, EJB容器是客户端程序和Beans之间看不见的中间人
3. 隐式中间件与显式中间件
    - 隐式中间件指的是不需要代码显式调用的中间件
    - 显式中间件是需要代码显式调用的中间件

## Web Service
1. Web服务是 对象/组件 技术在Internet的延伸, 是一种部署在Web上的 对象/组件
2. 三模块
    - 传输模块: 在线交互的标准, 如SOAP
    - 描述模块: 用于描述服务体或者服务的收集, 如 WSDL
    - 发现模块: 用于服务的发现, 如 通用发现,说明和集成(UDDI)