# 第六章 类文件结构
### 无关性的基石
1. 不同的平台开发不同的虚拟机, 虚拟机屏蔽底层细节
2. 字节码 - 程序无关性的基石
3. Java虚拟机只识别`.class`文件
4. `.class`文件包括了Java虚拟机指令集和符号表以及其他的辅助信息
5. 任何语言只要按照规定生成`.class`文件就可以在Java虚拟机上运行
---------
### Class类文件结构
1. class文件是一组以8位字节为单位的二进制流
2. 当需要大于8位字节的空间时, 按照高位在前的规定划分为多个8位字节存储
3. class文件采用伪结构来存储数据, 伪结构中只有两种数据类型
    - 无符号数: 基本的数据类型, 可以描述数字/索引引用/数量值或者是按照UTF-8编码构成的字符串值
        * u1/u2/u4/u8 表示 1/2/4/8 个字节的无符号数
    - 表: 由多个无符号数或者其他表作为数据项构成的复合数据类型. 整个class文件本质上就是一张表
4. 当需要描述同一类型数量不定的多个数据时, 经常使用一个前置的容量计数器加若干个连续的数据项的形式
-------
##### 魔数与class文件版本
1. 每个class文件的前四个字节称为**魔数**, 确定此文件能否可以被虚拟机接受
2. 5-8字节存储的是版本号
    - 5/6字节存储的次版本号
    - 7/8字节存储主版本号
    - 高版本的虚拟机可以执行低版本的class文件(向下兼容)
    - 低版本的虚拟机不可以执行高版本的class文件
------------
##### 常量池
1. 第九个字节为常量池入口
2. class文件的*资源仓库*, 是class文件中与其他项目关联最多的数据类型
3. 是**表**类型数据项
4. u2类型的数据表示常量池容量计算值
5. 容量计数从 **1** 开始, 0 表示不引用任何常量池内容
6. 主要存储两类常量:
    - 字面量
        * 类似于Java语言中的常量 例如 文本字符串/声明为final的常量值
    - 符号引用
        * 类和接口的全限定名称
        * 字段的名称和描述符
        * 方法的名称和描述符
7. class文件不存放方法/字段的最终内存布局信息, 在虚拟机加载时动态连接
8. 常量池中每一个常量都是一个表
    - 表的第一位是u1类型的标志位, 代表常量类型
         | 类型 | 标志 | 描述
        | :-- | :--: | :-- |
        |CONSTANT_Utf8_info|1|UTF-8编码的字符串|
        |CONSTANT_Integer_info|3|整形字面量|
        |CONSTANT_Float_info|4|浮点型字面量|
        |CONSTANT_Long_info|5|长整型字面量|
        |CONSTANT_Double_info|6|双精度浮点型字面量
        |CONSTANT_Class_info|7|类或者接口的符号引用
        |CONSTANT_String_info|8|字符串类型字面量
        |CONSTANT_Fieldref_info|9|字段符号引用
        |CONSTANT_Methodref_info|10|类中方法的符号引用
        |CONSTANT_InterfaceMethodref_info|11|接口中方法的符号引用
        |CONSTANT_NameAndType_info|12|字段或者方法的部分符号引用
        |CONSTANT_MethodHandle_info|15|方法句柄
        |CONSTANT_MethodType_info|16|方法类型
        |CONSTANT_InvokeDynamic_info|18|动态方法调用点
    - 每种常量类型都有自己的结构
    